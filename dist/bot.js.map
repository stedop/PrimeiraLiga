{"version":3,"sources":["bot.js"],"names":["Object","defineProperty","exports","value","_defaults2","require","_defaults3","_interopRequireDefault","_axios","_axios2","_snoowrap","_snoowrap2","_dot","_dot2","obj","__esModule","default","bot","constructor","_ref","arguments","length","undefined","userAgent","clientId","clientSecret","refreshToken","subreddit","apiKey","leagueId","Error","subbreddit","__initRedditClient","__initApiClient","__initTemplateEngine","redditClient","clientArgs","baseURL","timeout","headers","apiClient","create","templateEngine","process","templateSettings","strip","path","__replaceText","_ref2","old","begin","end","replacement","regstring","regex","RegExp","replace","getStandings","_this","data","standingsURI","Promise","resolve","reject","get","then","response","standings","error","getCompetition","_this2","competitionUri","competition","getFixtures","getCurrentSideBar","_this3","getSubreddit","getSettings","settings","sidebar","description","doTable","_this4","leagueCaption","table","doFixtures","_this5","updateSidebar","_this6","editSettings","completed","run","_this7"],"mappings":"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","file":"bot.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _defaults2 = require('lodash/defaults');\n\nvar _defaults3 = _interopRequireDefault(_defaults2);\n\nvar _axios = require('axios');\n\nvar _axios2 = _interopRequireDefault(_axios);\n\nvar _snoowrap = require('snoowrap');\n\nvar _snoowrap2 = _interopRequireDefault(_snoowrap);\n\nvar _dot = require('dot');\n\nvar _dot2 = _interopRequireDefault(_dot);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nclass bot {\n\n    /**\n     * @summary initialises the bot\n     *\n     * @param {string} [userAgent] A unique description of what your app does. This argument is not necessary when Snoowrap\n     is running in a browser.\n     * @param {string} [clientId] The client ID of your app (assigned by reddit)\n     * @param {string} [clientSecret] The client secret of your app (assigned by reddit). If you are using a refresh token\n     with an installed app (which does not have a client secret), pass an empty string as your `clientSecret`.\n     * @param {string} [refreshToken] A refresh token for your app.\n     * @param {string} [subreddit] The subreddit name we are going to be managing\n     * @param {string} [apiKey] Key for the stats api\n     * @param {string} [leagueId] Id for the competition\n     */\n    constructor() {\n        var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n            userAgent = _ref.userAgent,\n            clientId = _ref.clientId,\n            clientSecret = _ref.clientSecret,\n            refreshToken = _ref.refreshToken,\n            subreddit = _ref.subreddit,\n            apiKey = _ref.apiKey,\n            leagueId = _ref.leagueId;\n\n        if (clientId === undefined || clientSecret === undefined || refreshToken === undefined) {\n            throw new Error('Reddit Credentials not supplied');\n        }\n\n        if (apiKey === undefined) {\n            throw new Error('Api Key not supplied');\n        }\n\n        if (leagueId === undefined) {\n            throw new Error('Need a competition ID');\n        }\n\n        (0, _defaults3.default)(this, {\n            userAgent,\n            clientId,\n            clientSecret,\n            refreshToken,\n            subreddit,\n            apiKey,\n            leagueId\n        }, {\n            userAgent: null,\n            clientId: null,\n            clientSecret: null,\n            refreshToken: null,\n            subbreddit: null,\n            apiKey: null,\n            leagueId: 439\n        });\n\n        this.__initRedditClient();\n        this.__initApiClient();\n        this.__initTemplateEngine();\n    }\n\n    /**\n     * Sets up snoowrap\n     *\n     * @private\n     */\n    __initRedditClient() {\n        this.redditClient = new _snoowrap2.default({\n            userAgent: this.userAgent,\n            clientId: this.clientId,\n            clientSecret: this.clientSecret,\n            refreshToken: this.refreshToken\n        });\n    }\n\n    /**\n     * Sets up the Axios api client\n     *\n     * @private\n     */\n    __initApiClient() {\n        var clientArgs = {\n            baseURL: 'http://api.football-data.org/v1/',\n            timeout: 10000,\n            headers: {\n                \"X-Auth-Token\": this.apiKey,\n                \"Accept\": \"application/json\",\n                \"Content-Type\": \"application/json\"\n            }\n        };\n        this.apiClient = _axios2.default.create(clientArgs);\n    }\n\n    /**\n     * Sets up the Dot template engine\n     *\n     * @private\n     */\n    __initTemplateEngine() {\n        this.templateEngine = _dot2.default.process({ templateSettings: { strip: false }, path: 'views/' });\n    }\n\n    /**\n     * Handles the text replacements\n     *\n     * @param old\n     * @param begin\n     * @param end\n     * @param replacement\n     * @returns {string|*|void|XML}\n     * @private\n     */\n    __replaceText() {\n        var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n            old = _ref2.old,\n            begin = _ref2.begin,\n            end = _ref2.end,\n            replacement = _ref2.replacement;\n\n        var regstring = '(' + begin + ')([\\\\s\\\\S]*?)(\\\\*\\\\*\\\\*\\\\*\\\\*\\\\*)';\n        var regex = new RegExp(regstring, 'i');\n        return old.replace(regex, replacement);\n    }\n\n    /**\n     * get the current standings\n     *\n     * @param data\n     * @returns {Promise}\n     */\n    getStandings() {\n        var _this = this;\n\n        var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        var standingsURI = \"competitions/\" + this.leagueId + \"/leagueTable\";\n\n        return new Promise(function (resolve, reject) {\n            _this.apiClient.get(standingsURI).then(function (response) {\n                data.standings = response.data;\n                resolve(data);\n            }, function (error) {\n                reject(error);\n            });\n        });\n    }\n\n    /**\n     * Gets the competition data\n     *\n     * @param data\n     * @returns {Promise}\n     */\n    getCompetition() {\n        var _this2 = this;\n\n        var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        var competitionUri = \"competitions/\" + this.leagueId;\n        return new Promise(function (resolve, reject) {\n            _this2.apiClient.get(competitionUri).then(function (response) {\n                data.competition = response.data;\n                resolve(data);\n            }, function (error) {\n                reject(error);\n            });\n        });\n    }\n\n    /**\n     * Get fixtures\n     *\n     * @param data\n     * @returns {Promise}\n     */\n    getFixtures() {\n        var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        return new Promise(function (resolve) {\n            resolve(data);\n        });\n    }\n\n    /**\n     * Gets the current sidebar\n     *\n     * @param data\n     * @returns {Promise}\n     */\n    getCurrentSideBar() {\n        var _this3 = this;\n\n        var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        return new Promise(function (resolve, reject) {\n            _this3.redditClient.getSubreddit(_this3.subreddit).getSettings().then(function (settings) {\n                data.sidebar = settings.description;\n                resolve(data);\n            }, reject);\n        });\n    }\n\n    /**\n     * Handles the league table insert\n     *\n     * @param data\n     * @returns {Promise}\n     */\n    doTable() {\n        var _this4 = this;\n\n        var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        return new Promise(function (resolve) {\n            data.sidebar = _this4.__replaceText({\n                'old': data.sidebar,\n                'begin': '# [](#pt-NOS)' + data.standings.leagueCaption + ' - Current Table',\n                'end': '\\\\n\\\\n\\\\n******',\n                'replacement': _this4.templateEngine.table(data)\n            });\n            resolve(data);\n        });\n    }\n\n    /**\n     * Handles the standing insert\n     *\n     * @param data\n     * @returns {Promise}\n     */\n    doFixtures() {\n        var _this5 = this;\n\n        var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        return new Promise(function (resolve) {\n            data.sidebar = _this5.__replaceText({\n                'old': data.sidebar,\n                'begin': '# [](#pt-NOS)' + data.standings.leagueCaption,\n                'end': '\\\\n\\\\n\\\\n******',\n                'replacement': _this5.templateEngine.table(data)\n            });\n            resolve(data);\n        });\n    }\n\n    /**\n     * Updates the sidebar\n     *\n     * @param data\n     * @returns {Promise}\n     */\n    updateSidebar() {\n        var _this6 = this;\n\n        var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        var subreddit = this.subreddit;\n\n        return new Promise(function (resolve, reject) {\n            _this6.redditClient.getSubreddit(subreddit).editSettings({\n                'description': data.sidebar\n            }).then(function () {\n                data.completed = {};\n                data.completed.updateSidebar = true;\n                resolve(data);\n            }, function (error) {\n                reject(error);\n            });\n        });\n    }\n\n    /**\n     * Runs the whole thing together - tbh I'm not sure this should be here and not in the index file\n     */\n    run() {\n        var _this7 = this;\n\n        this.getStandings().then(function (data) {\n            return _this7.getCurrentSideBar(data);\n        }).then(function (data) {\n            return _this7.getStandings(data);\n        }).then(function (data) {\n            return _this7.getFixtures(data);\n        }).then(function (data) {\n            return _this7.doTable(data);\n        }).then(function (data) {\n            return _this7.doFixtures(data);\n        }).then(function (data) {\n            return _this7.updateSidebar(data);\n        });\n    }\n}\nexports.default = bot;\n//# sourceMappingURL=bot.js.map"]}